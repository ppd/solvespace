name: Deploy

on:
  workflow_run:
    workflows: [Test]
    # branches: [master, gh-actions]
    types:
      - completed
      - requested

jobs:
  macos:
    name: macOS
    runs-on: macos-latest
    steps:
    - uses: actions/checkout@v2
    - name: Install Dependencies
      run: .travis/install-macos.sh
    - name: Build & Test
      run: .travis/build-macos.sh release
    - name: Sign Build
      run: .travis/sign-macos.sh
    - name: Upload artifact
      uses: actions/upload-artifact@v2
      with:
        name: macos-dmg
        path: build/bin/SolveSpace.dmg

  windows:
    name: Windows
    runs-on: windows-2019
    steps:
    - uses: actions/checkout@v2
    - name: Install Dependencies
      run: .travis/install-windows.sh
      shell: bash
    - name: Build & Test
      run: .travis/build-windows.sh release
    - name: Upload artifact
      uses: actions/upload-artifact@v2
      with:
        name: windows-exe
        path: build/bin/RelWithDebInfo/solvespace.exe

  windows-openmp:
    name: Windows with OpenMP
    runs-on: windows-2019
    steps:
      - uses: actions/checkout@v2
      - name: Install Dependencies
        run: .travis/install-windows.sh
        shell: bash
      - name: Build & Test
        run: .travis/build-windows.sh release openmp
      - name: Upload artifact
        uses: actions/upload-artifact@v2
        with:
          name: windows-openmp-exe
          path: build/bin/RelWithDebInfo/solvespace-openmp.exe

  # update-edge-release:
  #   name: Update Edge Release
  #   runs-on: ubuntu-latest
  #   needs: [macOS, windows, windows-openmp]
